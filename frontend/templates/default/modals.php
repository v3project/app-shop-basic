<?/** * @author Semenov Alexander <semenov@skeeks.com> * @link http://skeeks.com/ * @copyright 2010 SkeekS (СкикС) * @date 01.03.2017 *//* @var $this \yii\web\View *//**/?><section class="modal fade" id="regionModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">    <div class="modal-dialog" role="document">        <form class="modal-box">            <button type="button" class="modal-close btn-circle fill" data-dismiss="modal">                <i class="fa fa-remove"></i>            </button>            <header class="modal-box-title">Ваш адрес</header>            <div class="form-group">                <? $this->registerCss(<<<CSS.sx-danger{    border-color: red !important;}.sx-other-message{    color: red;    text-align: left;    padding-top: 10px;    display: none;}.sx-more-regions{    color: #131313 !important;    border-bottom: solid 1px rgba(19,19,19,.7) !important;}CSS                ); ?>                <? $this->registerJs(<<<JS(function(sx, $, _){    sx.classes.GlobalInputRegion = sx.classes.Component.extend({        _onDomReady: function()        {            var self = this;            this.jInput = $('#sx-global-region-input');            self.jInput.on('keyup', function()            {                $(this).removeClass('sx-danger');                $('.sx-other-message').hide();            });            $(".sx-more-regions").on('click', function()            {                self.jInput.val('').focus();                self.jInput.addClass('sx-danger');                $('.sx-other-message').show();                return false;            });            $("#sx-save-region").on("click", function()            {                $(".sx-dadata-suggestion-city").empty().append(self.DadataSuggest.get('geoobject').data.city);                self.DadataSuggest.save();                return false;            });            /*$("#regionModal").on('shown.bs.modal', function () {              $("#sx-global-region-input").focus();                var tmpStr = $("#sx-global-region-input").val();                $("#sx-global-region-input").val('');                $("#sx-global-region-input").val(tmpStr);            });*/        },        _initSuggest: function(DadataSuggest)        {            this.DadataSuggest = DadataSuggest;            this.DadataSuggest.bind('onSelect', function()            {                $("#sx-save-region").show();            });        }    });    sx.GlobalDadataRegion = new sx.classes.GlobalInputRegion();    sx.classes.ModalRegionPageReload = sx.classes.Component.extend({        _init: function()        {            sx.GlobalDadataRegion.DadataSuggest.unbind('afterSave');            sx.GlobalDadataRegion.DadataSuggest.unbind('beforeSave');            sx.GlobalDadataRegion.DadataSuggest.bind('beforeSave', function()            {                _.delay(function()                {                    $("#regionModal").modal('hide');                }, 200);            });            sx.GlobalDadataRegion.DadataSuggest.bind('afterSave', function()            {                sx.block('body');                window.location.reload();            });            $("#regionModal").modal('show');        }    });    sx.classes.ModalRegionPjaxReload = sx.classes.Component.extend({        _init: function()        {            console.log('ModalRegionPjaxReload');            var self = this;            sx.GlobalDadataRegion.DadataSuggest.unbind('afterSave');            sx.GlobalDadataRegion.DadataSuggest.unbind('beforeSave');            sx.GlobalDadataRegion.DadataSuggest.bind('beforeSave', function()            {                _.delay(function()                {                    $("#regionModal").modal('hide');                }, 200);            });            sx.GlobalDadataRegion.DadataSuggest.bind('afterSave', function()            {                console.log('afterSave');                $.pjax.reload({container:'#' + self.get('id')});            });            $("#regionModal").modal('show');        }    });})(sx, sx.$, sx._);JS                ); ?>                <?= \skeeks\cms\dadataSuggest\widgets\suggest\DadataSuggestInputWidget::widget([                    'name' => 'address',                    'id' => 'sx-global-region-input',                    'addon' => 'clear',                    'value' => \Yii::$app->dadataSuggest->isSavedAddress ? \Yii::$app->dadataSuggest->address->unrestrictedValue : "",                    'clientOptions' => [                        'onInit' => new \yii\web\JsExpression(<<<JS                            function(e, data)                            {                                sx.GlobalDadataRegion._initSuggest(data.DadataSuggest);                            }JS                        )                    ],                    'options' =>                        [                            'class' => 'form-control',                            'placeholder' => 'Найти город',                        ]                ]); ?>                <div class="sx-other-message">Введите Ваш город!</div>                <button class="btn" style="margin-top: 20px; display: none;" id="sx-save-region">Сохранить</button>                <!--<input type="text" class="form-control" placeholder="Найти город"/>-->            </div>            <?= \v3toys\skeeks\widgets\delivery\V3toysCityListWidget::widget(); ?>        </form>    </div></section><!--#regionModal-->